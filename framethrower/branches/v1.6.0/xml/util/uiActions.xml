<f:includes
	xmlns:f="http://www.worldmerge.com/2008/xsl"
	xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
	xmlns:html="http://www.w3.org/1999/xhtml"
	xmlns:svg="http://www.w3.org/2000/svg">

	<f:action name="showPopup">
		<f:param name="x" type="Number" />
		<f:param name="y" type="Number" />
		<f:param name="width" type="Number" />
		<f:param name="height" type="Number" />
		<f:param name="content" type="Unit JS" />
		
		<f:derive name="main" d="ui.main" />
		<f:derive name="popups" d="UI.main:popup main" />
		
		<f:create type="UI.popup" name="popup">
			<f:with-param name="x" select="$x" />
			<f:with-param name="y" select="$y" />
			<f:with-param name="width" select="$width" />
			<f:with-param name="height" select="$height" />
			<f:with-param name="content" select="$content" />
		</f:create>
		
		<xsl:variable name="lastKey" select="$popups/f:entry[position() = last()]/f:key/f:literal" />
		<xsl:variable name="key">
			<xsl:choose>
				<xsl:when test="$lastKey">
					<xsl:call-template name="ord-bigger">
						<xsl:with-param name="s" select="$lastKey/@value" />
					</xsl:call-template>
				</xsl:when>
				<xsl:otherwise>b</xsl:otherwise>
			</xsl:choose>
		</xsl:variable>
		
		<f:intact object="$main" property="popup" action="add" value="$popup">
			<f:with-param name="key" select="$key" as="String" />
		</f:intact>
		
		<f:include url="ord.xml" />
	</f:action>
	
	<f:action name="hidePopup">
		<f:derive name="main" d="ui.main" />
		<f:derive name="popups" d="UI.main:popup main" />
		
		<xsl:variable name="lastKey" select="$popups/f:entry[position() = last()]/f:key/f:literal" />
		
		<xsl:if test="$lastKey">
			<f:intact object="$main" action="remove" property="popup" key="$lastKey" />
		</xsl:if>
		<!-- <f:intact object="$main" action="remove" property="popup" key="'b'" /> -->
	</f:action>
	
	<f:action name="stopDragging">
		<f:derive name="main" d="ui.main" />
		<f:intact object="$main" action="remove" property="dragging" />
	</f:action>

</f:includes>