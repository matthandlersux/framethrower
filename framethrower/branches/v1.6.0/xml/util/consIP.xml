<f:includes
	xmlns:f="http://www.worldmerge.com/2008/xsl"
	xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
	xmlns:html="http://www.w3.org/1999/xhtml"
	xmlns:svg="http://www.w3.org/2000/svg">

	<f:include url="/xml/util/actions.xml" />

	<f:action name="consIPToCons">
		<f:param name="consIP" type="UI.consIP" />
		<!-- <f:derive name="object" d="UI.consIP:object consIP" />
		<f:derive name="left" d="UI.consIP:left consIP" />
		<f:derive name="right" d="UI.consIP:right consIP" />
		
		<xsl:choose>
			<xsl:when test="$object">
				<f:return name="object" />
			</xsl:when>
			<xsl:otherwise>
				<f:perform with-action="$consIPToCons" name="leftR">
					<f:with-param name="consIP" select="$left" />
				</f:perform>
				<f:perform with-action="$consIPToCons" name="rightR">
					<f:with-param name="consIP" select="$right" />
				</f:perform>
				<f:perform with-action="$makeCons" name="cons">
					<f:with-param name="left" select="$leftR" />
					<f:with-param name="right" select="$rightR" />
				</f:perform>
				<f:return name="cons" />
			</xsl:otherwise>
		</xsl:choose> -->
		
		<f:derive name="left" d="UI.consIP:left consIP" />
		<f:derive name="right" d="UI.consIP:right consIP" />
		<f:derive name="leftAsObject" d="bindUnit UI.consIP:object left" />
		<f:derive name="rightAsObject" d="bindUnit UI.consIP:object right" />
		
		<xsl:if test="not($leftAsObject)">
			<f:perform with-action="$consIPToCons" name="leftR">
				<f:with-param name="consIP" select="$left" />
			</f:perform>
		</xsl:if>
		
		<xsl:if test="not($rightAsObject)">
			<f:perform with-action="$consIPToCons" name="rightR">
				<f:with-param name="consIP" select="$right" />
			</f:perform>
		</xsl:if>
		
		<f:perform with-action="$makeCons" name="cons">
			<xsl:choose>
				<xsl:when test="$leftAsObject">
					<f:with-param name="left" select="$leftAsObject" />
				</xsl:when>
				<xsl:otherwise>
					<f:with-param name="left"><f:var name="leftR" /></f:with-param>
				</xsl:otherwise>
			</xsl:choose>
			<xsl:choose>
				<xsl:when test="$rightAsObject">
					<f:with-param name="right" select="$rightAsObject" />
				</xsl:when>
				<xsl:otherwise>
					<f:with-param name="right"><f:var name="rightR" /></f:with-param>
				</xsl:otherwise>
			</xsl:choose>
		</f:perform>
		
		<f:return name="cons" />
		
	</f:action>

</f:includes>