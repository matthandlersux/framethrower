<f:action name="prepareState"
	xmlns:f="http://www.worldmerge.com/2008/xsl"
	xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
	xmlns:html="http://www.w3.org/1999/xhtml"
	xmlns:svg="http://www.w3.org/2000/svg">
	
	<f:derive name="in" d="shared.in" />
	<f:derive name="isA" d="shared.isA" />
	<f:derive name="name" d="shared.name" />
	
	<f:derive name="ont" d="shared.ont" />
	<f:derive name="realLife" d="shared.realLife" />
	<f:derive name="situationType" d="shared.type.situation" />
	<f:derive name="entityType" d="shared.type.entity" />
	<f:derive name="typeType" d="shared.type.type" />
	
	
	<f:perform with-action="$nameObject">
		<f:with-param name="object" select="$realLife" />
		<f:with-param name="name" select="'Real Life'" />
	</f:perform>
	<f:perform with-action="$typeObject">
		<f:with-param name="object" select="$realLife" />
		<f:with-param name="type" select="$situationType" />
	</f:perform>
	
	
	<f:perform with-action="$nameObject">
		<f:with-param name="object" select="$ont" />
		<f:with-param name="name" select="'Ontological Layer'" />
	</f:perform>
	<f:perform with-action="$typeObject">
		<f:with-param name="object" select="$ont" />
		<f:with-param name="type" select="$situationType" />
	</f:perform>
	
	
	<f:perform with-action="$nameObject">
		<f:with-param name="object" select="$situationType" />
		<f:with-param name="name" select="'Situation'" />
	</f:perform>
	<f:perform with-action="$typeObject">
		<f:with-param name="object" select="$situationType" />
		<f:with-param name="type" select="$typeType" />
	</f:perform>
	

	
	
	<f:perform with-action="$relationTemplateObject">
		<f:with-param name="object" select="$in" />
		<f:with-param name="relTem">
			<f:relationTemplate>
				<f:row>in <f:arg num="1" /></f:row>
				<f:row><f:arg num="2" /></f:row>
			</f:relationTemplate>
		</f:with-param>
	</f:perform>
	
	<f:perform with-action="$relationTemplateObject">
		<f:with-param name="object" select="$name" />
		<f:with-param name="relTem">
			<f:relationTemplate>
				<f:arg num="1" /> has name <f:arg num="2" />
			</f:relationTemplate>
		</f:with-param>
	</f:perform>
	
	<f:perform with-action="$relationTemplateObject">
		<f:with-param name="object" select="$isA" />
		<f:with-param name="relTem">
			<f:relationTemplate>
				<f:arg num="1" /> is a <f:arg num="2" />
			</f:relationTemplate>
		</f:with-param>
	</f:perform>
	
	
	
	
	<f:perform with-action="$makeNamedObject" name="sc">
		<f:with-param name="name" select="'Sean Connery'" />
		<f:with-param name="type" select="$entityType" />
	</f:perform>
	<f:perform with-action="$putObjectInSituation">
		<f:with-param name="situation" select="$realLife" />
		<f:with-param name="object" select="$sc" />
	</f:perform>
	
	<f:perform with-action="$makeNamedObject" name="gfmov">
		<f:with-param name="name" select="'Goldfinger'" />
		<f:with-param name="type" select="$situationType" />
	</f:perform>
	<f:perform with-action="$putObjectInSituation">
		<f:with-param name="situation" select="$realLife" />
		<f:with-param name="object" select="$gfmov" />
	</f:perform>
	
	<f:perform with-action="$makeNamedObject" name="jb">
		<f:with-param name="name" select="'James Bond'" />
		<f:with-param name="type" select="$entityType" />
	</f:perform>
	<f:perform with-action="$putObjectInSituation">
		<f:with-param name="situation" select="$gfmov" />
		<f:with-param name="object" select="$jb" />
	</f:perform>
	
	<f:create type="Object" name="performs" />
	<f:perform with-action="$relationTemplateObject">
		<f:with-param name="object" select="$performs" />
		<f:with-param name="relTem">
			<f:relationTemplate>
				<f:arg num="1" /> performs <f:arg num="2" />
			</f:relationTemplate>
		</f:with-param>
	</f:perform>
	
	<f:perform with-action="$makeInfon2" name="jbingfmov">
		<f:with-param name="relation" select="$in" />
		<f:with-param name="arg1" select="$gfmov" />
		<f:with-param name="arg2" select="$jb" />
	</f:perform>
	<f:perform with-action="$makeInfon2" name="scperformsjb">
		<f:with-param name="relation" select="$performs" />
		<f:with-param name="arg1" select="$sc" />
		<f:with-param name="arg2" select="$jbingfmov" />
	</f:perform>
	<f:perform with-action="$putObjectInSituation">
		<f:with-param name="situation" select="$realLife" />
		<f:with-param name="object" select="$scperformsjb" />
	</f:perform>
	
	
	
	
	<f:perform with-action="$initUI" />
	
	<f:action name="initUI">
		<f:derive name="prefs" d="ui.prefs" />
		<f:derive name="situationType" d="shared.type.situation" />
		<f:derive name="entityType" d="shared.type.entity" />
		<f:derive name="relationType" d="shared.type.relation" />
		
		<f:intact object="$prefs" property="typeDisplay" action="add" key="$situationType" value="'#2ae'" />
		<f:intact object="$prefs" property="typeDisplay" action="add" key="$entityType" value="'#8c3'" />
		<f:intact object="$prefs" property="typeDisplay" action="add" key="$relationType" value="'#e29'" />
		
	</f:action>
	
	
	
	

	
	
	
	
	<f:action name="makeNamedObject">
		<f:param name="name" type="String" />
		<f:param name="type" type="Object" />
				
		<f:create type="Object" name="object" />

		<f:perform with-action="$nameObject" name="nameObject">
			<f:with-param name="object" select="$object" />
			<f:with-param name="name" select="$name" />
		</f:perform>
		<f:perform with-action="$typeObject">
			<f:with-param name="object" select="$object" />
			<f:with-param name="type" select="$type" />
		</f:perform>
		
		<f:return name="object" />
	</f:action>
	
	<f:action name="nameObject">
		<f:param name="object" type="Object" />
		<f:param name="name" type="String" />
		
		<f:derive name="nameRel" d="shared.name" />
		
		<f:create type="X.text" name="nameText">
			<f:with-param name="string" select="$name" />
		</f:create>
		
		<f:perform with-action="$makeOntProperty">
			<f:with-param name="relation" select="$nameRel" />
			<f:with-param name="arg1" select="$object" />
			<f:with-param name="arg2" select="$nameText" />
		</f:perform>
	</f:action>
	
	<f:action name="relationTemplateObject">
		<f:param name="object" type="Object" />
		<f:param name="relTem" type="XML" />
		
		<f:derive name="relTemRel" d="shared.relationTemplate" />
		
		<f:create type="X.xml" name="xml">
			<f:with-param name="xml" select="$relTem" />
		</f:create>
		
		<f:perform with-action="$makeOntProperty">
			<f:with-param name="relation" select="$relTemRel" />
			<f:with-param name="arg1" select="$object" />
			<f:with-param name="arg2" select="$xml" />
		</f:perform>
	</f:action>
	
	
	
	<f:action name="typeObject">
		<f:param name="object" type="Object" />
		<f:param name="type" type="Object" />
		
		<f:derive name="isA" d="shared.isA" />
		
		<f:perform with-action="$makeOntProperty">
			<f:with-param name="relation" select="$isA" />
			<f:with-param name="arg1" select="$object" />
			<f:with-param name="arg2" select="$type" />
		</f:perform>
	</f:action>
	
	
	
	<f:action name="makeOntProperty">
		<f:param name="relation" type="Object" />
		<f:param name="arg1" type="Object" />
		<f:param name="arg2" type="Object" />
		
		<f:perform with-action="$makeInfon2" name="infon">
			<f:with-param name="relation" select="$relation" />
			<f:with-param name="arg1" select="$arg1" />
			<f:with-param name="arg2" select="$arg2" />
		</f:perform>
		
		<f:perform with-action="$makeTrueInOnt">
			<f:with-param name="infon" select="$infon" />
		</f:perform>
	</f:action>
	
	
	
	<f:action name="makeTrueInOnt">
		<f:param name="infon" type="Cons" />
		<f:derive name="ont" d="shared.ont" />
		
		<f:perform with-action="$putObjectInSituation">
			<f:with-param name="object" select="$infon" />
			<f:with-param name="situation" select="$ont" />
		</f:perform>
	</f:action>
	
	
	
	
	<f:action name="putObjectInSituation">
		<f:param name="object" type="Object" />
		<f:param name="situation" type="Object" />
		<f:derive name="in" d="shared.in" />
		
		<f:perform with-action="$makeInfon2" name="infon">
			<f:with-param name="relation" select="$in" />
			<f:with-param name="arg1" select="$situation" />
			<f:with-param name="arg2" select="$object" />
		</f:perform>
		<f:intact object="$infon" property="truth" action="add" key="null" />
	</f:action>
	
	
	
	<f:action name="makeInfon2">
		<f:param name="relation" type="Object" />
		<f:param name="arg1" type="Object" />
		<f:param name="arg2" type="Object" />		
		
		<f:perform with-action="$makeCons" name="cons1">
			<f:with-param name="left" select="$relation" />
			<f:with-param name="right" select="$arg1" />
		</f:perform>

		<f:perform with-action="$makeCons" name="cons2">
			<f:with-param name="left" select="$cons1" />
			<f:with-param name="right" select="$arg2" />
		</f:perform>
		
		<f:return name="cons2" />
	</f:action>	
	
	<f:action name="makeCons">
		<f:param name="left" type="Object" />
		<f:param name="right" type="Object" />
		
		<f:create type="Cons" name="cons">
			<f:with-param name="left" select="$left" />
			<f:with-param name="right" select="$right" />
		</f:create>
		
		<f:intact object="$left" property="upRight" action="add" key="$cons" />
		<f:intact object="$right" property="upLeft" action="add" key="$cons" />
		
		<f:return name="cons" />
	</f:action>
	
</f:action>