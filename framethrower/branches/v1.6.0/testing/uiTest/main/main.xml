<f:template name="testTemplate"
	xmlns:f="http://www.worldmerge.com/2008/xsl"
	xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
	xmlns:html="http://www.w3.org/1999/xhtml"
	xmlns:svg="http://www.w3.org/2000/svg">
	
	<f:derive name="main" d="ui.main" />
	<f:derive name="pane" d="UI.main:pane ui.main" />
	<f:derive name="popup" d="UI.main:popup ui.main" />
	<f:derive name="dragging" d="UI.main:dragging ui.main" />
	
	<f:derive name="screenWidth" d="UI.ui:screenWidth ui.ui" />
	<f:derive name="screenHeight" d="UI.ui:screenHeight ui.ui" />

	<xsl:if test="$screenWidth and $screenHeight">
		<html:div>
			<xsl:if test="$dragging">
				<xsl:attribute name="class">dragging</xsl:attribute>
			</xsl:if>
		
			<f:thunk url="../paneset/pane.xml">
				<f:with-param name="closePane" select="$closeTopPane" />
				<f:with-param name="openPane" select="$openTopPane" />
				<f:with-param name="pane" select="$pane" />
				<f:with-param name="width" select="$screenWidth" />
				<f:with-param name="height" select="$screenHeight" />
			</f:thunk>
		
			<!-- <f:thunk url="../view.xml" /> -->
		
			<f:on event="dragEnd" with-action="$stopDragging" />

			<xsl:if test="$popup">
				<html:div class="popupbg">
					<xsl:call-template name="style">
						<xsl:with-param name="width" select="$screenWidth/@value" />
						<xsl:with-param name="height" select="$screenHeight/@value" />
					</xsl:call-template>
					<f:on event="click" with-action="$hidePopup" />
				</html:div>
				<f:thunk url="popup.xml">
					<f:with-param name="popup" select="$popup" />
					<f:with-param name="width" select="$screenWidth" />
					<f:with-param name="height" select="$screenHeight" />			
				</f:thunk>
			</xsl:if>
		
			<xsl:if test="$dragging">
				<f:thunk with-template="$drawDragger">
					<f:with-param name="dragging" select="$dragging" />
				</f:thunk>
			</xsl:if>
		
		</html:div>
	</xsl:if>
	
	<f:template name="drawDragger">
		<f:param name="dragging" type="UI.dragging" />
		<f:derive name="object" d="UI.dragging:object dragging" />
		<f:derive name="mouseX" d="UI.ui:mouseX ui.ui" />
		<f:derive name="mouseY" d="UI.ui:mouseY ui.ui" />
		<html:div>
			<xsl:call-template name="style">
				<xsl:with-param name="left" select="$mouseX/@value + 5" />
				<xsl:with-param name="top" select="$mouseY/@value + 2" />
			</xsl:call-template>
			
			<f:thunk url="../view2/object.xml">
				<f:with-param name="focus" select="$object" />
			</f:thunk>
		</html:div>
	</f:template>
	
	<f:action name="closeTopPane" />
	<f:action name="openTopPane">
		<f:param name="focus" type="Object" />
	</f:action>
	
	<f:include url="/xml/util/uiActions.xml" />
	<f:include url="/xml/util/style.xml" />
</f:template>