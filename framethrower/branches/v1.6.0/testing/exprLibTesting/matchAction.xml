<f:action name="actionTest"
	xmlns:f="http://www.worldmerge.com/2008/xsl"
	xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
	xmlns:html="http://www.w3.org/1999/xhtml"
	xmlns:svg="http://www.w3.org/2000/svg">
	
	<f:param name="rootObj" type="K.object"/>
	
	<f:derive name="in" d="shared.in" />
	<f:derive name="nameRel" d="shared.name" />
	<f:derive name="thumbnail" d="shared.thumbnail" />
	<f:derive name="ont" d="shared.ont" />
	
	
	<!-- These are "Leaf" objects. They each will have a name infon <in, ont, <name, Term, 'term'>> -->
	
	<f:perform with-action="$makeObjWithName" name="Term">
		<f:with-param name="name" select="'Term'" />
	</f:perform>
	<f:perform with-action="$makeObjWithName" name="Scene1">
		<f:with-param name="name" select="'Scene1'" />
	</f:perform>
	<f:perform with-action="$makeObjWithName" name="JSIV">
		<f:with-param name="name" select="'JSIV'" />
	</f:perform>
	<f:perform with-action="$makeObjWithName" name="T2">
		<f:with-param name="name" select="'T2'" />
	</f:perform>


	<!-- This is "InOntName". Just for testing. Might not actually make sense. -->
	<f:perform with-action="$makeBinaryInfon" >
		<f:with-param name="relation" select="$in" />
		<f:with-param name="arg1" select="$ont" />
		<f:with-param name="arg2" select="$nameRel" />		
	</f:perform>



	<f:perform with-action="$makeBinaryInfon" name="inScene1Term">
		<f:with-param name="relation" select="$in" />
		<f:with-param name="arg1" select="$Scene1" />
		<f:with-param name="arg2" select="$Term" />		
	</f:perform>
	
	<f:perform with-action="$makeBinaryInfon" name="inT2inScene1Term">
		<f:with-param name="relation" select="$in" />
		<f:with-param name="arg1" select="$T2" />
		<f:with-param name="arg2" select="$inScene1Term" />		
	</f:perform>
	
	<f:perform with-action="$makeBinaryInfon" name="inJSIVinT2inScene1Term">
		<f:with-param name="relation" select="$in" />
		<f:with-param name="arg1" select="$JSIV" />
		<f:with-param name="arg2" select="$inT2inScene1Term" />		
	</f:perform>
	
	
	
	<f:create type="X.text" name="thumbLink">
		<f:with-param name="string" select="'http://example.thumbnail.com/pic.jpg'" />
	</f:create>
	
	<f:perform with-action="$makeBinaryInfon" name="thumbInfon">
		<f:with-param name="relation" select="$thumbnail" />
		<f:with-param name="arg1" select="$inJSIVinT2inScene1Term" />
		<f:with-param name="arg2" select="$thumbLink" />
	</f:perform>
	
	<f:perform with-action="$makeBinaryInfon" >
		<f:with-param name="relation" select="$in" />
		<f:with-param name="arg1" select="$ont" />
		<f:with-param name="arg2" select="$thumbInfon" />		
	</f:perform>
	
	
	<f:intact object="$rootObj" property="upLeft" action="add" key="$inJSIVinT2inScene1Term" />
	

	<f:action name="makeObjWithName">
		<f:derive name="ont" d="shared.ont" />
		
		<f:param name="name" type="String" />
				
		<f:create type="K.object" name="obj" />

		<f:create type="X.text" name="nameText">
			<f:with-param name="string" select="$name" />
		</f:create>
		
		<f:perform with-action="$makeBinaryInfon" name = "nameInfon">
			<f:with-param name="relation" select="$nameRel" />
			<f:with-param name="arg1" select="$obj" />
			<f:with-param name="arg2" select="$nameText" />		
		</f:perform>
		
		<f:perform with-action="$makeBinaryInfon">
			<f:with-param name="relation" select="$in" />
			<f:with-param name="arg1" select="$ont" />
			<f:with-param name="arg2" select="$nameInfon" />		
		</f:perform>
		
		<f:return name="obj" />
	</f:action>
	
	<f:action name="makeBinaryInfon">
		<f:param name="relation" type="K.object" />
		<f:param name="arg1" type="K.object" />
		<f:param name="arg2" type="K.object" />		
		
		<f:perform with-action="$makeCons" name="cons1">
			<f:with-param name="left" select="$relation" />
			<f:with-param name="right" select="$arg1" />
		</f:perform>

		<f:perform with-action="$makeCons" name="cons2">
			<f:with-param name="left" select="$cons1" />
			<f:with-param name="right" select="$arg2" />
		</f:perform>
		
		<f:return name="cons2" />
	</f:action>	
	
	<f:action name="makeCons">
		<f:param name="left" type="K.object" />
		<f:param name="right" type="K.object" />
		
		<f:create type="K.cons" name="cons">
			<f:with-param name="left" select="$left" />
			<f:with-param name="right" select="$right" />
		</f:create>
		
		<f:intact object="$left" property="upRight" action="add" key="$cons" />
		<f:intact object="$right" property="upLeft" action="add" key="$cons" />
		
		<f:return name="cons" />
	</f:action>
	
</f:action>