<f:function
	xmlns:f="http://www.filmsfolded.com/xsl/ui"
	xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
	xmlns:html="http://www.w3.org/1999/xhtml"
	xmlns:svg="http://www.w3.org/2000/svg">

	<f:param name="zui" />
	<f:param name="width" />
	<f:param name="height" />
	<f:param name="panelLayer" />
	<f:param name="addPanel" />	
	
	<f:derived name="properties" from="panelLayer">
		<f:get what="properties" />
	</f:derived>
	
	<f:derived name="addInfon" from="panelLayer">
		<f:get what="addInfon" />
	</f:derived>
	
	<f:derived name="tooltip" from="panelLayer">
		<f:get what="tooltip" />
	</f:derived>
	
	<f:derived name="videoTimelines" from="panelLayer">
		<f:get what="videoTimelines" />
	</f:derived>
	
	
	<xsl:template>
		<xsl:variable name="videoTimelineHeight" select="200" />
		
		<html:div>
			<html:div>
				<xsl:variable name="vts" select="$videoTimelines/*" />
				<xsl:variable name="h" select="$height/@value" />
				<xsl:variable name="zuiHeight" select="$h - count($vts) * $videoTimelineHeight" />
				
				<f:thunk url="zui.xml">
					<f:with-param name="zui" value-id="{$zui/@id}" />
					<f:with-param name="width"><xsl:copy-of select="$width" /></f:with-param>
					<f:with-param name="height"><f:number value="{$zuiHeight}" /></f:with-param>
					<f:with-param name="panelLayer" value-id="{$panelLayer/@id}" />
					<f:with-param name="addPanel" value-id="{$addPanel/@id}" />
				</f:thunk>
				
				<xsl:for-each select="$vts">
					<html:div left="0" top="{$zuiHeight + count(preceding-sibling::*)}">
						<f:thunk url="videoTimeline/videoTimeline.xml">
							<f:with-param name="width"><xsl:copy-of select="$width" /></f:with-param>
							<f:with-param name="height"><f:number value="{$videoTimelineHeight}" /></f:with-param>
							<f:with-param name="videoTimeline"><xsl:copy-of select="." /></f:with-param>
						</f:thunk>
					</html:div>
				</xsl:for-each>
			</html:div>
			
			<xsl:if test="$properties/@addObject='1'">
				<f:thunk url="addObject.xml">
					<f:with-param name="width"><xsl:copy-of select="$width" /></f:with-param>
					<f:with-param name="height"><xsl:copy-of select="$height" /></f:with-param>
					<f:with-param name="panelLayer" value-id="{$panelLayer/@id}" />
					<f:with-param name="addPanel" value-id="{$addPanel/@id}" />
				</f:thunk>
			</xsl:if>

			<xsl:if test="$properties/@addCorresponds='1'">
				<f:thunk url="addCorresponds.xml">
					<f:with-param name="width"><xsl:copy-of select="$width" /></f:with-param>
					<f:with-param name="height"><xsl:copy-of select="$height" /></f:with-param>
					<f:with-param name="panelLayer" value-id="{$panelLayer/@id}" />
				</f:thunk>
			</xsl:if>
			
			<xsl:if test="$addInfon/@value='true'">
				<f:thunk url="addInfon.xml">
					<f:with-param name="width"><xsl:copy-of select="$width" /></f:with-param>
					<f:with-param name="height"><xsl:copy-of select="$height" /></f:with-param>
					<f:with-param name="panelLayer" value-id="{$panelLayer/@id}" />
					<f:with-param name="addPanel" value-id="{$addPanel/@id}" />
				</f:thunk>
			</xsl:if>
			
			<xsl:if test="$tooltip">
				<f:thunk url="tooltip.xml">
					<f:with-param name="width"><xsl:copy-of select="$width" /></f:with-param>
					<f:with-param name="height"><xsl:copy-of select="$height" /></f:with-param>
					<f:with-param name="tooltip"><xsl:copy-of select="$tooltip" /></f:with-param>
				</f:thunk>
			</xsl:if>
			
		</html:div>
	</xsl:template>
	
	
</f:function>