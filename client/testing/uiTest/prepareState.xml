<f:action name="prepareState"
	xmlns:f="http://www.worldmerge.com/2008/xsl"
	xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
	xmlns:html="http://www.w3.org/1999/xhtml"
	xmlns:svg="http://www.w3.org/2000/svg">
	
	<f:derive name="in" d="shared.in" />
	<f:derive name="isA" d="shared.isA" />
	
	<f:derive name="ont" d="shared.ont" />
	<f:derive name="realLife" d="shared.realLife" />
	
	<f:derive name="type" d="shared.type" />
	<f:derive name="situationType" d="shared.type.situation" />
	<f:derive name="entityType" d="shared.type.entity" />
	<f:derive name="infonType" d="shared.type.infon" />
	<f:derive name="polyA" d="shared.type.poly.a" />
	
	
	<f:perform with-action="$nameObject">
		<f:with-param name="object" select="$type" />
		<f:with-param name="name" select="'Type'" />
	</f:perform>
	<f:perform with-action="$makeType">
		<f:with-param name="object" select="$type" />
	</f:perform>
	<f:perform with-action="$typeObject">
		<f:with-param name="object" select="$situationType" />
		<f:with-param name="type" select="$type" />
	</f:perform>
	<f:perform with-action="$typeObject">
		<f:with-param name="object" select="$entityType" />
		<f:with-param name="type" select="$type" />
	</f:perform>
	
	
	<f:perform with-action="$nameObject">
		<f:with-param name="object" select="$situationType" />
		<f:with-param name="name" select="'Situation'" />
	</f:perform>
	<f:perform with-action="$nameObject">
		<f:with-param name="object" select="$entityType" />
		<f:with-param name="name" select="'Entity'" />
	</f:perform>
	<f:perform with-action="$makeType">
		<f:with-param name="object" select="$entityType" />
	</f:perform>
	
	
	<f:perform with-action="$nameObject">
		<f:with-param name="object" select="$realLife" />
		<f:with-param name="name" select="'Real Life'" />
	</f:perform>
	<f:perform with-action="$typeObject">
		<f:with-param name="object" select="$realLife" />
		<f:with-param name="type" select="$situationType" />
	</f:perform>
	
	
	<f:perform with-action="$nameObject">
		<f:with-param name="object" select="$ont" />
		<f:with-param name="name" select="'Ontological Layer'" />
	</f:perform>
	<f:perform with-action="$typeObject">
		<f:with-param name="object" select="$ont" />
		<f:with-param name="type" select="$situationType" />
	</f:perform>
	
	
	<f:perform with-action="$nameObject">
		<f:with-param name="object" select="$situationType" />
		<f:with-param name="name" select="'Situation'" />
	</f:perform>
	<f:perform with-action="$makeType">
		<f:with-param name="object" select="$situationType" />
	</f:perform>
	

	
	
	<f:perform with-action="$relationTemplateObject">
		<f:with-param name="object" select="$in" />
		<f:with-param name="relTem">
			<f:relationTemplate>
				<f:row>in <f:arg num="1" /></f:row>
				<f:row><f:arg num="2" /></f:row>
			</f:relationTemplate>
		</f:with-param>
	</f:perform>
	<f:perform with-action="$makeRelationType2" name="situationToAToA">
		<f:with-param name="input1" select="$situationType" />
		<f:with-param name="input2" select="$polyA" />
		<f:with-param name="output" select="$polyA" />
	</f:perform>
	<f:perform with-action="$typeObject">
		<f:with-param name="object" select="$in" />
		<f:with-param name="type" select="$situationToAToA" />
	</f:perform>
	
	<f:perform with-action="$relationTemplateObject">
		<f:with-param name="object" select="$isA" />
		<f:with-param name="relTem">
			<f:relationTemplate>
				<f:arg num="1" /> is a <f:arg num="2" />
			</f:relationTemplate>
		</f:with-param>
	</f:perform>
	
	
	<!-- ==========================================================================
	Artifact association relations
	=========================================================================== -->
	
	<f:derive name="name" d="shared.name" />
	<f:derive name="video" d="shared.video" />
	<f:derive name="thumbnail" d="shared.thumbnail" />

	<f:perform with-action="$relationTemplateObject">
		<f:with-param name="object" select="$name" />
		<f:with-param name="relTem">
			<f:relationTemplate>
				<f:arg num="1" /> has name <f:arg num="2" />
			</f:relationTemplate>
		</f:with-param>
	</f:perform>
	<f:perform with-action="$relationTemplateObject">
		<f:with-param name="object" select="$video" />
		<f:with-param name="relTem">
			<f:relationTemplate>
				<f:arg num="1" /> has video <f:arg num="2" />
			</f:relationTemplate>
		</f:with-param>
	</f:perform>
	<f:perform with-action="$relationTemplateObject">
		<f:with-param name="object" select="$thumbnail" />
		<f:with-param name="relTem">
			<f:relationTemplate>
				<f:arg num="1" /> has picture <f:arg num="2" />
			</f:relationTemplate>
		</f:with-param>
	</f:perform>
	
	
	<!-- ==========================================================================
	Additional Types
	=========================================================================== -->
	
	<f:derive name="movieType" d="shared.type.movie" />
	<f:derive name="locationType" d="shared.type.location" />
	<f:derive name="agentType" d="shared.type.agent" />
	
	<!-- <f:perform with-action="$nameObject">
		<f:with-param name="object" select="$movieType" />
		<f:with-param name="name" select="'Movie'" />
	</f:perform>
	<f:perform with-action="$typeObject">
		<f:with-param name="object" select="$movieType" />
		<f:with-param name="type" select="$entityType" />
	</f:perform>
	<f:perform with-action="$makeType">
		<f:with-param name="object" select="$movieType" />
	</f:perform> -->
	
	<f:perform with-action="$nameObject">
		<f:with-param name="object" select="$locationType" />
		<f:with-param name="name" select="'Location'" />
	</f:perform>
	<f:perform with-action="$typeObject">
		<f:with-param name="object" select="$locationType" />
		<f:with-param name="type" select="$entityType" />
	</f:perform>
	<f:perform with-action="$makeType">
		<f:with-param name="object" select="$locationType" />
	</f:perform>
	
	<f:perform with-action="$nameObject">
		<f:with-param name="object" select="$agentType" />
		<f:with-param name="name" select="'Agent'" />
	</f:perform>
	<f:perform with-action="$typeObject">
		<f:with-param name="object" select="$agentType" />
		<f:with-param name="type" select="$entityType" />
	</f:perform>
	<f:perform with-action="$makeType">
		<f:with-param name="object" select="$agentType" />
	</f:perform>
	
	<!-- ==========================================================================
	Global preferences
	=========================================================================== -->
	
	<f:derive name="prefs" d="shared.globalPrefs" />
	
	<f:intact object="$prefs" property="typeColors" action="add" key="$situationType" value="'#2ae'" />
	<f:intact object="$prefs" property="typeColors" action="add" key="$entityType" value="'#5a1'" />
	
	<f:intact object="$prefs" property="typeColors" action="add" key="$movieType" value="'#a22'" />
	<f:intact object="$prefs" property="typeColors" action="add" key="$locationType" value="'#829'" />
	<f:intact object="$prefs" property="typeColors" action="add" key="$agentType" value="'#9e1'" />
	
	<!-- ==========================================================================
	Movie/Video Timeline Relations/Types
	=========================================================================== -->
	
	<!-- <f:derive name="movieStory" d="shared.movie.story" />
	<f:derive name="moviePresentation" d="shared.movie.presentation" />
	<f:derive name="movieMaking" d="shared.movie.making" />
	
	<f:perform with-action="$makeRelationType" name="movieToSituation">
		<f:with-param name="input" select="$movieType" />
		<f:with-param name="output" select="$situationType" />
	</f:perform>
	
	<f:perform with-action="$typeObject">
		<f:with-param name="object" select="$movieStory" />
		<f:with-param name="type" select="$movieToSituation" />
	</f:perform>
	<f:perform with-action="$relationTemplateObject">
		<f:with-param name="object" select="$movieStory" />
		<f:with-param name="relTem">
			<f:relationTemplate>
				<f:arg num="1" />'s Story
			</f:relationTemplate>
		</f:with-param>
	</f:perform>
	<f:perform with-action="$typeObject">
		<f:with-param name="object" select="$moviePresentation" />
		<f:with-param name="type" select="$movieToSituation" />
	</f:perform>
	<f:perform with-action="$relationTemplateObject">
		<f:with-param name="object" select="$moviePresentation" />
		<f:with-param name="relTem">
			<f:relationTemplate>
				<f:arg num="1" />'s Presentation
			</f:relationTemplate>
		</f:with-param>
	</f:perform>
	<f:perform with-action="$typeObject">
		<f:with-param name="object" select="$movieMaking" />
		<f:with-param name="type" select="$movieToSituation" />
	</f:perform>
	<f:perform with-action="$relationTemplateObject">
		<f:with-param name="object" select="$movieMaking" />
		<f:with-param name="relTem">
			<f:relationTemplate>
				<f:arg num="1" />'s Making
			</f:relationTemplate>
		</f:with-param>
	</f:perform> -->



	<!-- ==========================================================================
	Video time ranges/points
	=========================================================================== -->	
	
	<!-- <f:derive name="movieTimeRange" d="shared.movie.timeRange" />
	<f:perform with-action="$relationTemplateObject">
		<f:with-param name="object" select="$movieTimeRange" />
		<f:with-param name="relTem">
			<f:relationTemplate>
				<f:arg num="1" /> at <f:arg num="2" />
			</f:relationTemplate>
		</f:with-param>
	</f:perform> -->

	<f:derive name="videoTime" d="shared.video.time" />
	<f:perform with-action="$relationTemplateObject">
		<f:with-param name="object" select="$videoTime" />
		<f:with-param name="relTem">
			<f:relationTemplate>
				<f:arg num="1" /> at <f:arg num="2" />
			</f:relationTemplate>
		</f:with-param>
	</f:perform>
	
	
	<f:derive name="atTime" d="shared.atTime" />
	<f:perform with-action="$relationTemplateObject">
		<f:with-param name="object" select="$atTime" />
		<f:with-param name="relTem">
			<f:relationTemplate>
				on <f:arg num="1" />
			</f:relationTemplate>
		</f:with-param>
	</f:perform>
	
	<!-- TODO: I don't like how this is, ontologically. Am just doing it so it reads well for this Apr 1 demo. Really "on" should be a binary relation :: Situation -> Date -> Situation -->
	<f:perform with-action="$makeRelationType" name="toSituation">
		<f:with-param name="input" select="$type" />
		<f:with-param name="output" select="$situationType" />
	</f:perform>
	
	<f:perform with-action="$typeObject">
		<f:with-param name="object" select="$atTime" />
		<f:with-param name="type" select="$toSituation" />
	</f:perform>
	
	
	<!-- ==========================================================================
	Wall-E Example
	=========================================================================== -->
	
	<!-- <f:create type="X.video" name="walleVideo">
		<f:with-param name="url" select="'devise-walle.mp4'" />
		<f:with-param name="width" select="720" />
		<f:with-param name="height" select="304" />
		<f:with-param name="duration" select="5894.139" />
		<f:with-param name="frameRate" select="23.976024627686" />
	</f:create>
	
	<f:derive name="walleMovie" d="shared.test.walleMovie" />
	<f:perform with-action="$nameObject">
		<f:with-param name="object" select="$walleMovie" />
		<f:with-param name="name" select="'Wall-E'" />
	</f:perform>
	<f:perform with-action="$typeObject">
		<f:with-param name="object" select="$walleMovie" />
		<f:with-param name="type" select="$movieType" />
	</f:perform>
	
	<f:perform with-action="$putObjectInSituation">
		<f:with-param name="situation" select="$realLife" />
		<f:with-param name="object" select="$walleMovie" />
	</f:perform>
	
	<f:perform with-action="$makeOntProperty">
		<f:with-param name="relation" select="$video" />
		<f:with-param name="arg1" select="$walleMovie" />
		<f:with-param name="arg2" select="$walleVideo" />
	</f:perform>
	
	
	
	<f:perform with-action="$makeInfon1" name="walleStory">
		<f:with-param name="relation" select="$movieStory" />
		<f:with-param name="arg1" select="$walleMovie" />
	</f:perform>
	<f:perform with-action="$putObjectInSituation">
		<f:with-param name="situation" select="$realLife" />
		<f:with-param name="object" select="$walleStory" />
	</f:perform>
	<f:perform with-action="$makeInfon1" name="wallePresentation">
		<f:with-param name="relation" select="$moviePresentation" />
		<f:with-param name="arg1" select="$walleMovie" />
	</f:perform>
	<f:perform with-action="$putObjectInSituation">
		<f:with-param name="situation" select="$realLife" />
		<f:with-param name="object" select="$wallePresentation" />
	</f:perform>
	<f:perform with-action="$makeInfon1" name="walleMaking">
		<f:with-param name="relation" select="$movieMaking" />
		<f:with-param name="arg1" select="$walleMovie" />
	</f:perform>
	<f:perform with-action="$putObjectInSituation">
		<f:with-param name="situation" select="$realLife" />
		<f:with-param name="object" select="$walleMaking" />
	</f:perform> -->




	<!-- ==========================================================================
	James Bond Example	
	=========================================================================== -->

	
	
	<!-- <f:perform with-action="$makeNamedObject" name="sc">
		<f:with-param name="name" select="'Sean Connery'" />
		<f:with-param name="type" select="$agentType" />
	</f:perform>
	<f:perform with-action="$putObjectInSituation">
		<f:with-param name="situation" select="$realLife" />
		<f:with-param name="object" select="$sc" />
	</f:perform>
	
	<f:perform with-action="$makeNamedObject" name="gfmov">
		<f:with-param name="name" select="'Goldfinger'" />
		<f:with-param name="type" select="$movieType" />
	</f:perform>
	<f:perform with-action="$putObjectInSituation">
		<f:with-param name="situation" select="$realLife" />
		<f:with-param name="object" select="$gfmov" />
	</f:perform>
	
	<f:perform with-action="$makeInfon1" name="gfmovstory">
		<f:with-param name="relation" select="$movieStory" />
		<f:with-param name="arg1" select="$gfmov" />
	</f:perform>
	
	<f:perform with-action="$makeNamedObject" name="jb">
		<f:with-param name="name" select="'James Bond'" />
		<f:with-param name="type" select="$agentType" />
	</f:perform>
	<f:perform with-action="$putObjectInSituation">
		<f:with-param name="situation" select="$gfmovstory" />
		<f:with-param name="object" select="$jb" />
	</f:perform>
	
	<f:create type="Object" name="performs" />
	<f:perform with-action="$nameObject">
		<f:with-param name="object" select="$performs" />
		<f:with-param name="name" select="'Performs'" />
	</f:perform>
	<f:perform with-action="$relationTemplateObject">
		<f:with-param name="object" select="$performs" />
		<f:with-param name="relTem">
			<f:relationTemplate>
				<f:arg num="1" /> performs <f:arg num="2" />
			</f:relationTemplate>
		</f:with-param>
	</f:perform>
	<f:perform with-action="$makeRelationType2" name="entityToEntityToInfon">
		<f:with-param name="input1" select="$entityType" />
		<f:with-param name="input2" select="$entityType" />
		<f:with-param name="output" select="$infonType" />
	</f:perform>
	<f:perform with-action="$typeObject">
		<f:with-param name="object" select="$performs" />
		<f:with-param name="type" select="$entityToEntityToInfon" />
	</f:perform>
	<f:perform with-action="$putObjectInSituation">
		<f:with-param name="situation" select="$ont" />
		<f:with-param name="object" select="$performs" />
	</f:perform>
	
	<f:create type="Object" name="believes" />
	<f:perform with-action="$nameObject">
		<f:with-param name="object" select="$believes" />
		<f:with-param name="name" select="'Believes'" />
	</f:perform>
	<f:perform with-action="$relationTemplateObject">
		<f:with-param name="object" select="$believes" />
		<f:with-param name="relTem">
			<f:relationTemplate>
				<f:arg num="1" /> believes <f:arg num="2" />
			</f:relationTemplate>
		</f:with-param>
	</f:perform>
	<f:perform with-action="$makeRelationType2" name="entityToSituationToInfon">
		<f:with-param name="input1" select="$entityType" />
		<f:with-param name="input2" select="$situationType" />
		<f:with-param name="output" select="$infonType" />
	</f:perform>
	<f:perform with-action="$typeObject">
		<f:with-param name="object" select="$believes" />
		<f:with-param name="type" select="$entityToSituationToInfon" />
	</f:perform>
	<f:perform with-action="$putObjectInSituation">
		<f:with-param name="situation" select="$ont" />
		<f:with-param name="object" select="$believes" />
	</f:perform>
	
	<f:create type="Object" name="gives" />
	<f:perform with-action="$nameObject">
		<f:with-param name="object" select="$gives" />
		<f:with-param name="name" select="'Gives ... to'" />
	</f:perform>
	<f:perform with-action="$relationTemplateObject">
		<f:with-param name="object" select="$gives" />
		<f:with-param name="relTem">
			<f:relationTemplate>
				<f:arg num="1" /> gives <f:arg num="2" /> to <f:arg num="3" />
			</f:relationTemplate>
		</f:with-param>
	</f:perform>
	<f:perform with-action="$makeRelationType3" name="entityToEntityToEntityToInfon">
		<f:with-param name="input1" select="$entityType" />
		<f:with-param name="input2" select="$entityType" />
		<f:with-param name="input3" select="$entityType" />
		<f:with-param name="output" select="$infonType" />
	</f:perform>
	<f:perform with-action="$typeObject">
		<f:with-param name="object" select="$gives" />
		<f:with-param name="type" select="$entityToEntityToEntityToInfon" />
	</f:perform>
	<f:perform with-action="$putObjectInSituation">
		<f:with-param name="situation" select="$ont" />
		<f:with-param name="object" select="$gives" />
	</f:perform>
	
	
	
	
	
	
	<f:perform with-action="$makeInfon2" name="jbingfmovstory">
		<f:with-param name="relation" select="$in" />
		<f:with-param name="arg1" select="$gfmovstory" />
		<f:with-param name="arg2" select="$jb" />
	</f:perform>
	<f:perform with-action="$makeInfon2" name="scperformsjb">
		<f:with-param name="relation" select="$performs" />
		<f:with-param name="arg1" select="$sc" />
		<f:with-param name="arg2" select="$jbingfmovstory" />
	</f:perform>
	<f:perform with-action="$putObjectInSituation">
		<f:with-param name="situation" select="$realLife" />
		<f:with-param name="object" select="$scperformsjb" />
	</f:perform> -->
	
	
	
	
	
	<!-- ==========================================================================
	Charlene Thumbnail Example
	=========================================================================== -->
	
	<!-- <f:perform with-action="$makeNamedObject" name="charlene">
		<f:with-param name="name" select="'Charlene'" />
		<f:with-param name="type" select="$agentType" />
	</f:perform>
	<f:perform with-action="$putObjectInSituation">
		<f:with-param name="situation" select="$realLife" />
		<f:with-param name="object" select="$charlene" />
	</f:perform>
	<f:perform with-action="$thumbnailObject">
		<f:with-param name="object" select="$charlene" />
		<f:with-param name="url" select="'charlene.jpg'" />
		<f:with-param name="width" select="640" />
		<f:with-param name="height" select="480" />
	</f:perform> -->
	








	<!-- ==========================================================================
	Utility	
	=========================================================================== -->




	
	
	
	<f:include url="/xml/util/actions.xml" />
	
</f:action>