<f:function
	xmlns:f="http://www.filmsfolded.com/xsl/ui"
	xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
	xmlns:html="http://www.w3.org/1999/xhtml"
	xmlns:svg="http://www.w3.org/2000/svg">
	
	<f:param name="zui" />
	<f:param name="focus" />
	<f:param name="panelLayer" />
	<f:param name="addPanel" />
	<f:derived name="properties" from="panelLayer">
		<f:get what="properties" />
	</f:derived>
	
	<f:derived name="childrenByType" from="focus">
		<f:get what="childrenByType" />
	</f:derived>

	<f:derived name="expandedTypes" from="zui">
		<f:get what="expandedTypes" />
	</f:derived>
	
	<xsl:template>
		<html:div style="padding-bottom: 40px;">
			<xsl:for-each select="$childrenByType/*">
				<xsl:variable name="typeId" select="f:key/*/@id" />
				<xsl:variable name="expanded" select="$expandedTypes/*[@id = $typeId]" />
				
				<html:div>
					
					<html:div class="blackButton" style="position: relative; height: 18px; margin: 3px;">
						<f:binding url="bindings/type.xml">
							<f:with-param name="zui"><xsl:copy-of select="$zui" /></f:with-param>
							<f:with-param name="type"><xsl:copy-of select="f:key/*" /></f:with-param>
						</f:binding>
						<html:div class="blackButtonRight" />
						<html:div class="blackButtonLeft" />
						<html:div class="buttonContent" style="color:#fff; position:relative; top:-2px; left: 6px;">
							<xsl:choose>
								<xsl:when test="$expanded">
									<html:div class="expanded" />
									<!-- <html:img src="../images/expanded.png" width="13" height="13" /> -->
								</xsl:when>
								<xsl:otherwise>
									<html:div class="collapsed" />
									<!-- <html:img src="../images/collapsed.png" width="13" height="13" /> -->
								</xsl:otherwise>
							</xsl:choose>

							<f:thunk url="printContent.xml">
								<f:with-param name="focus"><xsl:copy-of select="f:key/*" /></f:with-param>
								<f:with-param name="style"><f:string value="inline" /></f:with-param>
							</f:thunk>
						</html:div>
					</html:div>
					


					<xsl:if test="$expanded">
						<html:div class="zuiChildrenSidebarItemList">
							<xsl:for-each select="f:value/f:set/*">
								<html:div class="zuiChildrenSidebarItem" style="border-color:#9e2">
									<xsl:choose>
										<xsl:when test="$properties/@addCorresponds = '1'">
											<f:binding url="bindings/addCorresponds.xml">
												<f:with-param name="addFocus"><xsl:copy-of select="." /></f:with-param>
												<f:with-param name="panelLayer" value-id="{$panelLayer/@id}" />
											</f:binding>
											<f:button name="secondArg" />
										</xsl:when>									
										<xsl:otherwise>
											<f:binding url="bindings/child.xml">
												<f:with-param name="zui"><xsl:copy-of select="$zui" /></f:with-param>
												<f:with-param name="focus"><xsl:copy-of select="." /></f:with-param>
											</f:binding>
										</xsl:otherwise>
									</xsl:choose>
								
									<f:thunk url="printContent.xml">
										<f:with-param name="focus"><xsl:copy-of select="." /></f:with-param>
										<f:with-param name="style"><f:string value="listentry" /></f:with-param>
									</f:thunk>
								</html:div>
							</xsl:for-each>
						</html:div>							
					</xsl:if>
					
				</html:div>
			</xsl:for-each>
		</html:div>
	</xsl:template>
	
</f:function>