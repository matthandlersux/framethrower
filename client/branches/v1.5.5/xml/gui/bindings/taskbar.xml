<f:binding
	xmlns:f="http://www.filmsfolded.com/xsl/ui"
	xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
	
	<f:transaction name="Minimize" event="click" button="minimize">
		<f:param name="zui" />
		<f:param name="openZuiCount" />

		<f:derived name="parentZui" from="zui">
			<f:get what="parentZui" />
		</f:derived>
		
		<f:derived name="leftChildInView" from="parentZui">
			<f:get what="leftChildInView" />
		</f:derived>
		
		<xsl:template>
			<f:transaction>
				<f:intact with-id="{$zui/@id}" prop="minimized" action="set">
					<f:with-param>
						<f:bool value="true" />
					</f:with-param>
				</f:intact>
				
				<xsl:variable name="childWindow">
					<xsl:choose>
						<xsl:when test="$openZuiCount/@value = 2 or $openZuiCount/@value = 1 or $openZuiCount/@value = 0">
							1
						</xsl:when>
						<xsl:otherwise>
							2
						</xsl:otherwise>
					</xsl:choose>
				</xsl:variable>
				
				<xsl:if test="$leftChildInView/@value = ($openZuiCount/@value - $childWindow)" >
					<f:intact with-id="{$parentZui/@id}" prop="leftChildInView" action="set">
						<f:with-param>
							<f:number value="{$leftChildInView/@value - ($childWindow - 1)}" />
						</f:with-param>
					</f:intact>
				</xsl:if>
				
			</f:transaction>
		</xsl:template>		
	</f:transaction>
	
	
	<f:transaction name="Restore" event="click" button="restore">
		<f:param name="zui" />

		<xsl:template>
			<f:transaction>
				<f:intact with-id="{$zui/@id}" prop="minimized" action="set">
					<f:with-param>
						<f:bool value="false" />
					</f:with-param>
				</f:intact>
			</f:transaction>
		</xsl:template>		
	</f:transaction>
	
	
	
	
	
	
	<f:transaction name="Center" event="click" button="center">
		<f:param name="zui" />
				
		<f:derived name="parentZui" from="zui">
			<f:get what="parentZui" />
		</f:derived>
		
		<f:derived name="leftChildInView" from="parentZui">
			<f:get what="leftChildInView" />
		</f:derived>
		
		<f:derived name="childZuisMinimized" from="parentZui">
			<f:get what="childZuis" />
			<f:buildassoc what="minimized" />	
		</f:derived>


		<xsl:template>
			<xsl:variable name="openZuis" select="$childZuisMinimized/f:pair[f:value/f:bool/@value = 'false']" />
			<xsl:variable name="openZuiCount" select="count($openZuis)" />

			<xsl:variable name="childWindow">
				<xsl:choose>
					<xsl:when test="$openZuiCount = 1 or $openZuiCount = 0">
						1
					</xsl:when>
					<xsl:otherwise>
						2
					</xsl:otherwise>
				</xsl:choose>
			</xsl:variable>
			
			<xsl:variable name="index" select="count($childZuisMinimized/*[f:key/*/@id = $zui/@id]/preceding-sibling::*[f:value/*/@value = 'false'])" />
			<f:transaction>
				<f:intact with-id="{$parentZui/@id}" prop="leftChildInView" action="set">
					<f:with-param>
						<xsl:choose>
							<xsl:when test="$leftChildInView/@value &gt; $index">
								<f:number value="{$index}" />
							</xsl:when>
							<xsl:otherwise>
								<f:number value="{$index - $childWindow + 1}" />
							</xsl:otherwise>
						</xsl:choose>
					</f:with-param>
				</f:intact>
			</f:transaction>
		</xsl:template>		
	</f:transaction>
	
	
	
</f:binding>
