<f:template name="testTemplate"
	xmlns:f="http://www.worldmerge.com/2008/xsl"
	xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
	xmlns:html="http://www.w3.org/1999/xhtml"
	xmlns:svg="http://www.w3.org/2000/svg">
	
	<f:param name="focus" type="Cons" />
	<f:param name="recurse" type="a -> Unit JS" />
	
	<f:derive name="infonArgs" d="getInfonArguments focus" />
	<f:derive name="template" d="(bindSet getRelationTemplate) (getInfonRelations focus)" />
	
	<f:derive name="types" d="getTypesMap (Cons~Object focus)" />
	<f:derive name="typeDisplay" d="X.prefs:typeColors shared.globalPrefs" />
	
	<f:derive name="thumbnail" d="bindUnitSet Object~X.picture (getOntProp shared.thumbnail (Cons~Object focus))" />
	
	<f:include url="/xml/util/typeColor.xml" />
	
	<xsl:variable name="rt" select="$template/f:literal/f:relationTemplate" />
	<xsl:if test="$rt">
		<xsl:variable name="color">
			<xsl:call-template name="typeColor">
				<xsl:with-param name="typeNames" select="$types/f:entry/f:value/f:set/f:o/@name" />
				<xsl:with-param name="typeDisplay" select="$typeDisplay" />
			</xsl:call-template>
		</xsl:variable>
		
		<xsl:variable name="extra">
			<f:each select="$thumbnail" position="1">
				<f:thunk url="media/picture.xml">
					<f:with-param name="focus" select="$thumbnail" />
					<f:with-param name="transform"><f:transform width="30" height="30" /></f:with-param>
				</f:thunk>
			</f:each>
		</xsl:variable>
		
		<xsl:call-template name="print">
			<xsl:with-param name="relationTemplate" select="$rt" />
			<xsl:with-param name="infonArgs" select="$infonArgs" />
			<xsl:with-param name="argTemplate" select="$printArg" />
			<xsl:with-param name="color" select="$color" />
			<xsl:with-param name="extra" select="$extra" />
		</xsl:call-template>
	</xsl:if>
	
	<f:each select="$infonArgs" key="key" value="val">
		<f:each select="$val" key="obj">
			<f:thunkadvice url="view.xml">
				<f:with-param name="focus" select="$obj" />
			</f:thunkadvice>
		</f:each>
	</f:each>
	
	<f:template name="printArg">
		<f:param name="focus" type="Object" />
		<f:param name="num" type="Number" />
		
		<f:thunk with-template="$recurse">
			<f:with-param name="focus" select="$focus" />
			<f:with-param name="recurse" select="$recurse" />
		</f:thunk>
	</f:template>
	

	<f:include url="util/printInfon.xml" />
</f:template>