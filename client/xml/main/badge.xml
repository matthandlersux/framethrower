<f:template name="testTemplate"
	xmlns:f="http://www.worldmerge.com/2008/xsl"
	xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
	xmlns:html="http://www.w3.org/1999/xhtml"
	xmlns:svg="http://www.w3.org/2000/svg">
	
	<f:param name="focus" type="Object" />
	<f:param name="direction" type="String" />
	<f:param name="arrowOffset" type="Number" />
	<f:param name="newPane" type="a -> Unit JS" />
	

	<f:derive name="name" d="getName focus" />
	
	<f:derive name="typeDisplay" d="X.prefs:typeColors shared.globalPrefs" />
	
	<f:derive name="focustypes" d="getOntProp shared.isA focus" />
	
	<f:derive name="thumbnail" d="bindUnitSet Object~X.picture (getOntProp shared.thumbnail focus)" />
	
	<f:derive name="video" d="bindUnitSet Object~X.video (getOntProp shared.video focus)" />
	
	<f:derive name="serverBaseUrl" d="serverBaseUrl" />
	
	
	<xsl:variable name="offset" select="$arrowOffset/@value" />
	
	<xsl:choose>
		<xsl:when test="$direction/@value = 'left'">
			<html:div class="badgeArrow baShadowLeft">
				<xsl:call-template name="style">
					<xsl:with-param name="left" select="-70" />
					<xsl:with-param name="top" select="$offset" />
				</xsl:call-template>
			</html:div>
			<html:div class="badgeArrow baLeft">
				<xsl:call-template name="style">
					<xsl:with-param name="left" select="-58" />
					<xsl:with-param name="top" select="$offset" />
				</xsl:call-template>
			</html:div>
		</xsl:when>
		<xsl:when test="$direction/@value = 'right'">
			<html:div class="badgeArrow baShadowRight">
				<xsl:call-template name="style">
					<xsl:with-param name="right" select="-70" />
					<xsl:with-param name="top" select="$offset" />
				</xsl:call-template>
			</html:div>
			<html:div class="badgeArrow baRight">
				<xsl:call-template name="style">
					<xsl:with-param name="right" select="-58" />
					<xsl:with-param name="top" select="$offset" />
				</xsl:call-template>
			</html:div>
		</xsl:when>
		<xsl:when test="$direction/@value = 'top'">
			<html:div class="badgeArrow baShadowTop">
				<xsl:call-template name="style">
					<xsl:with-param name="top" select="-70" />
					<xsl:with-param name="left" select="$offset" />
				</xsl:call-template>
			</html:div>
			<html:div class="badgeArrow baTop">
				<xsl:call-template name="style">
					<xsl:with-param name="top" select="-58" />
					<xsl:with-param name="left" select="$offset" />
				</xsl:call-template>				
			</html:div>
		</xsl:when>
		<xsl:when test="$direction/@value = 'bottom'">
			<html:div class="badgeArrow baShadowBottom">
				<xsl:call-template name="style">
					<xsl:with-param name="bottom" select="-70" />
					<xsl:with-param name="left" select="$offset" />
				</xsl:call-template>
			</html:div>
			<html:div class="badgeArrow baBottom">
				<xsl:call-template name="style">
					<xsl:with-param name="bottom" select="-58" />
					<xsl:with-param name="left" select="$offset" />
				</xsl:call-template>
			</html:div>
		</xsl:when>
		<xsl:otherwise>
		</xsl:otherwise>
	</xsl:choose>
	
	<html:div class="badgePopout">
		<f:on event="click" with-action="$newPaneAndClose">
			<f:with-param name="focus" select="$focus" />
		</f:on>
	</html:div>
	<html:div class="badgeContent">
		<html:div>
			<b><xsl:value-of select="$name/*/@value" /></b>
		</html:div>
		<f:each select="$focustypes" key="type">
			<html:div>
				<f:thunk url="../view2/object.xml">
					<f:with-param name="focus" select="$type" />
				</f:thunk>
			</html:div>
		</f:each>
		<f:each select="$thumbnail">
			<html:div>
				<f:thunk url="../view2/media/picture.xml">
					<f:with-param name="focus" select="$thumbnail" />
					<f:with-param name="transform"><f:transform width="240" height="240" /></f:with-param>
				</f:thunk>
			</html:div>
		</f:each>
		<f:each select="$video">
			<html:div>
				<f:thunk url="../view2/media/videoPlayer.xml">
					<f:with-param name="focus" select="$video" />
					<f:with-param name="transform"><f:transform width="240" height="240" /></f:with-param>
				</f:thunk>
			</html:div>
		</f:each>
	</html:div>

	<f:action name="newPaneAndClose">
		<f:param name="focus" type="Object" />
		
		<f:perform with-action="$newPane">
			<f:with-param name="focus" select="$focus" />
		</f:perform>
		
		<f:perform with-action="$hidePopup" />
	</f:action>

	<f:include url="/xml/util/uiActions.xml" />
	<f:include url="/xml/util/actions.xml" />
	<f:include url="/xml/util/style.xml" />
</f:template>