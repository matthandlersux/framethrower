<f:template name="testTemplate"
	xmlns:f="http://www.worldmerge.com/2008/xsl"
	xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
	xmlns:html="http://www.w3.org/1999/xhtml"
	xmlns:svg="http://www.w3.org/2000/svg">
	
	<f:derive name="main" d="ui.main" />
	<f:derive name="pane" d="UI.main:pane ui.main" />
	<f:derive name="popup" d="UI.main:popup ui.main" />
	<f:derive name="dragging" d="UI.main:dragging ui.main" />
	
	<f:derive name="screenWidth" d="UI.ui:screenWidth ui.ui" />
	<f:derive name="screenHeight" d="UI.ui:screenHeight ui.ui" />
	
	<f:each select="$screenWidth">
		<f:each select="$screenHeight">
			<html:div>
				<f:each select="$dragging">
					<xsl:attribute name="class">dragging</xsl:attribute>
				</f:each>
				
				<f:on event="dragEnd" with-action="$stopDragging" />
				
				<f:each select="$pane">
					<f:thunk url="../paneset/pane.xml">
						<f:with-param name="closePane" select="$closeTopPane" />
						<f:with-param name="showBadge" select="$topShowBadge" />
						<f:with-param name="newPane" select="$topNewPane" />
						<f:with-param name="pane" select="$pane" />
						<f:with-param name="width" select="$screenWidth" />
						<f:with-param name="height" select="$screenHeight" />
					</f:thunk>
				</f:each>
				
				<f:each select="$popup" key="ord" value="popup">
					<html:div class="popupbg">
						<xsl:call-template name="style">
							<xsl:with-param name="width" select="$screenWidth/@value" />
							<xsl:with-param name="height" select="$screenHeight/@value" />
						</xsl:call-template>
						<f:on event="click" with-action="$hidePopup" />
					</html:div>
					<f:thunk url="popup.xml">
						<f:with-param name="popup" select="$popup" />
						<f:with-param name="width" select="$screenWidth" />
						<f:with-param name="height" select="$screenHeight" />			
					</f:thunk>
				</f:each>
				
				<f:each select="$dragging">
					<f:thunk with-template="$drawDragger">
						<f:with-param name="dragging" select="$dragging" />
					</f:thunk>
				</f:each>
				
			</html:div>
		</f:each>
	</f:each>
	
	<f:template name="drawDragger">
		<f:param name="dragging" type="UI.dragging" />
		<f:derive name="object" d="UI.dragging:object dragging" />
		<f:derive name="mouseX" d="UI.ui:mouseX ui.ui" />
		<f:derive name="mouseY" d="UI.ui:mouseY ui.ui" />
		<f:each select="$object"><f:each select="$mouseX"><f:each select="$mouseY">
			<html:div>
				<xsl:call-template name="style">
					<xsl:with-param name="left" select="$mouseX/@value + 5" />
					<xsl:with-param name="top" select="$mouseY/@value + 2" />
				</xsl:call-template>
			
				<f:thunk url="../view2/viewPlus.xml">
					<f:with-param name="focus" select="$object" />
					<f:with-param name="extra" select="$noExtra" />
				</f:thunk>
			</html:div>
		</f:each></f:each></f:each>
		<f:template name="noExtra">
			<f:param name="focus" type="Object" />
		</f:template>
	</f:template>
	
	<f:action name="closeTopPane" />
	<f:action name="topShowBadge">
		<f:param name="focus" type="Object" />
		<f:param name="elemX" type="Number" />
		<f:param name="elemY" type="Number" />
		<f:param name="elemWidth" type="Number" />
		<f:param name="elemHeight" type="Number" />
		<f:param name="openObject" type="a -> Unit JS" />
	</f:action>
	
	<f:action name="topNewPane">
		<f:param name="focus" type="Object" />
	</f:action>
	
	<f:include url="/xml/util/uiActions.xml" />
	<f:include url="/xml/util/style.xml" />
</f:template>