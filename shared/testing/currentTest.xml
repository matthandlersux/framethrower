<tests>
	<test name='setDifferenceTest1'>
		<startcap name='sc' type='set number' />
		<startcap name='sc2' type='set number' />
		<messages>
			<set scname = 'sc'>
				<number value='1' />
			</set>
			<set scname = 'sc'>
				<number value='5' />
			</set>
			<set scname = 'sc'>
				<number value='7' />
			</set>
			<set scname = 'sc2'>
				<number value='5' />
			</set>
			<set scname = 'sc2'>
				<number value='6' />
			</set>
		</messages>
	
		<endcap name = 'ec' expression = 'setDifference sc sc2' />

		<expectedmessages>
			<set ecname = 'ec' >
				<number value = '1' />
			</set>
			<set ecname = 'ec' >
				<number value = '7' />
			</set>
		</expectedmessages>
		
		<messages>
			<remove scname = 'sc2'>
				<number value='5' />
			</remove>
		</messages>
		
		<expectedmessages>
			<set ecname = 'ec' >
				<number value = '5' />
			</set>
		</expectedmessages>
	</test>
	
	<test name='unionTest1'>
		<startcap name='sc' type='set number' />
		<startcap name='sc2' type='set number' />
		<messages>
			<set scname = 'sc'>
				<number value='1' />
			</set>
			<set scname = 'sc'>
				<number value='5' />
			</set>
			<set scname = 'sc2'>
				<number value='5' />
			</set>
			<set scname = 'sc2'>
				<number value='3' />
			</set>
		</messages>
	
		<endcap name = 'ec' expression = 'union sc sc2' />

		<expectedmessages>
			<set ecname = 'ec' >
				<number value = '1' />
			</set>
			<set ecname = 'ec' >
				<number value = '3' />
			</set>
			<set ecname = 'ec' >
				<number value = '5' />
			</set>
		</expectedmessages>
		
		<messages>
			<remove scname = 'sc'>
				<number value='5' />
			</remove>
			<remove scname = 'sc'>
				<number value='1' />
			</remove>
		</messages>
		
		<expectedmessages>
			<remove ecname = 'ec' >
				<number value = '1' />
			</remove>
		</expectedmessages>
	</test>


	<test name='foldTest1'>
		<startcap name='sc' type='set number' />

		<endcap name = 'ec' expression = 'fold add subtract 0 sc' />

		<messages>
			<set scname = 'sc'>
				<number value='2' />
			</set>
			<set scname = 'sc'>
				<number value='5' />
			</set>
		</messages>

		<expectedmessages>
			<set ecname = 'ec' >
				<number value = '0' />
			</set>
			<remove ecname = 'ec' >
				<number value = '0' />
			</remove>
			<set ecname = 'ec' >
				<number value = '2' />
			</set>
			<remove ecname = 'ec' >
				<number value = '2' />
			</remove>
			<set ecname = 'ec' >
				<number value = '7' />
			</set>
		</expectedmessages>

		<messages>
			<set scname = 'sc'>
				<number value='3' />
			</set>
			<set scname = 'sc'>
				<number value='5' />
			</set>
			<remove scname = 'sc'>
				<number value='2' />
			</remove>
		</messages>
	
		<expectedmessages>
			<remove ecname = 'ec' >
				<number value = '7' />
			</remove>
			<set ecname = 'ec' >
				<number value = '10' />
			</set>
			<remove ecname = 'ec' >
				<number value = '10' />
			</remove>
			<set ecname = 'ec' >
				<number value = '8' />
			</set>
		</expectedmessages>
	</test>

	<test name='mapTest1'>
		<startcap name='sc' type='unit number' />
	
		<messages>
			<set scname = 'sc'>
				<number value='2' />
			</set>
		</messages>

		<endcap name = 'ec' expression = 'returnUnitMap 1 sc' />

		<expectedmessages>
			<set ecname = 'ec' >
				<number value = '1' />
				<number value = '2' />
			</set>
		</expectedmessages>
	
		<messages>
			<remove scname = 'sc'>
				<number value='2' />
			</remove>
			<set scname = 'sc'>
				<number value='4' />
			</set>
		</messages>
	
		<expectedmessages>
			<remove ecname = 'ec' >
				<number value = '1' />
			</remove>
			<set ecname = 'ec' >
				<number value = '1' />
				<number value = '4' />
			</set>
		</expectedmessages>
	
		<messages>
			<remove scname = 'sc'>
				<number value='4' />
			</remove>
		</messages>
	
		<expectedmessages>
			<remove ecname = 'ec' >
				<number value = '1' />
			</remove>
		</expectedmessages>
	
	</test>

	<test name='bindSetTest1'>
		<startcap name='sc' type='set number' />
	
		<messages>
			<set scname = 'sc'>
				<number value='4' />
			</set>
		</messages>
	
		<endcap name = 'ec' expression = 'bindSet oneTo sc' />

		<expectedmessages>
			<set ecname = 'ec' >
				<number value = '1' />
			</set>
			<set ecname = 'ec' >
				<number value = '2' />
			</set>
			<set ecname = 'ec' >
				<number value = '3' />
			</set>
			<set ecname = 'ec' >
				<number value = '4' />
			</set>
		</expectedmessages>
	
		<messages>
			<set scname = 'sc'>
				<number value='6' />
			</set>
		</messages>
	
		<expectedmessages>
			<set ecname = 'ec' >
				<number value = '5' />
			</set>
			<set ecname = 'ec' >
				<number value = '6' />
			</set>
		</expectedmessages>
		
		<messages>
			<remove scname = 'sc'>
				<number value='6' />
			</remove>
		</messages>
	
		<expectedmessages>
			<remove ecname = 'ec' >
				<number value = '5' />
			</remove>
			<remove ecname = 'ec' >
				<number value = '6' />
			</remove>
		</expectedmessages>
	
	</test>

	<test name='bindMapTest1'>
		<startcap name='sc' type='map number number' />
	
		<messages>
			<set scname = 'sc'>
				<number value='4' />
				<number value='1' />
			</set>
		</messages>
	
		<endcap name = 'ec' expression = 'bindMap oneToMap sc' />

		<expectedmessages>
			<set ecname = 'ec' >
				<number value = '1' />
				<number value = '1' />
			</set>
			<set ecname = 'ec' >
				<number value = '2' />
				<number value = '1' />
			</set>
			<set ecname = 'ec' >
				<number value = '3' />
				<number value = '1' />
			</set>
			<set ecname = 'ec' >
				<number value = '4' />
				<number value = '1' />
			</set>
		</expectedmessages>
	
		<messages>
			<set scname = 'sc'>
				<number value='6' />
				<number value='2' />
			</set>
		</messages>
	
		<expectedmessages>
			<set ecname = 'ec' >
				<number value = '5' />
				<number value = '2' />
			</set>
			<set ecname = 'ec' >
				<number value = '6' />
				<number value = '2' />
			</set>
		</expectedmessages>
		
		<messages>
			<remove scname = 'sc'>
				<number value='6' />
			</remove>
		</messages>
	
		<expectedmessages>
			<remove ecname = 'ec' >
				<number value = '5' />
			</remove>
			<remove ecname = 'ec' >
				<number value = '6' />
			</remove>
		</expectedmessages>

	</test>

	<test name='bindMapTest2'>
		<startcap name='sc' type='map number number' />
	
		<messages>
			<set scname = 'sc'>
				<number value='4' />
				<number value='1' />
			</set>
		</messages>
	
		<endcap name = 'ec' expression = 'bindMap oneToMap sc' />
		<endcap name = 'ec2' expression = 'bindMap x2ToMap sc' />
		
		<expectedmessages>
			<set ecname = 'ec2' >
				<number value = '8' />
				<number value = '1' />
			</set>
			<set ecname = 'ec' >
				<number value = '1' />
				<number value = '1' />
			</set>
			<set ecname = 'ec' >
				<number value = '2' />
				<number value = '1' />
			</set>
			<set ecname = 'ec' >
				<number value = '3' />
				<number value = '1' />
			</set>
			<set ecname = 'ec' >
				<number value = '4' />
				<number value = '1' />
			</set>
		</expectedmessages>

		<messages>
			<set scname = 'sc'>
				<number value='6' />
				<number value='2' />
			</set>
		</messages>
	
		<expectedmessages>
			<set ecname = 'ec2' >
				<number value = '12' />
				<number value = '2' />
			</set>
			<set ecname = 'ec' >
				<number value = '5' />
				<number value = '2' />
			</set>
			<set ecname = 'ec' >
				<number value = '6' />
				<number value = '2' />
			</set>
		</expectedmessages>

		<messages>
			<remove scname = 'sc'>
				<number value='6' />
			</remove>
		</messages>
	
		<expectedmessages>
			<remove ecname = 'ec' >
				<number value = '5' />
			</remove>
			<remove ecname = 'ec' >
				<number value = '6' />
			</remove>
			<remove ecname = 'ec2' >
				<number value = '12' />
			</remove>
		</expectedmessages>

	</test>

	<test name='invertTest1'>
		<startcap name='sc' type='map number (set number)' />
		<startcap name='sc1' type='set number' />
		<startcap name='sc2' type='set number' />
		<startcap name='sc3' type='set number' />
	
		<messages>
			<set scname = 'sc'>
				<number value='1' />
				<sc name='sc1' />
			</set>
			<set scname = 'sc'>
				<number value='2' />
				<sc name='sc2' />
			</set>
			<set scname = 'sc'>
				<number value='3' />
				<sc name='sc3' />
			</set>
			<set scname = 'sc1'>
				<number value='10' />
			</set>
			<set scname = 'sc1'>
				<number value='20' />
			</set>
			<set scname = 'sc2'>
				<number value='20' />
			</set>
			<set scname = 'sc2'>
				<number value='30' />
			</set>
			<set scname = 'sc3'>
				<number value='10' />
			</set>
			<set scname = 'sc3'>
				<number value='30' />
			</set>
		</messages>
	
		<endcap name = 'ec' expression = 'invert sc' />

		<expectedmessages>
			<set ecname = 'ec' >
				<number value = '10' />
				<sc name = 'outCap10' />
			</set>
			<set ecname = 'ec' >
				<number value = '20' />
				<sc name = 'outCap20' />
			</set>
			<set ecname = 'ec' >
				<number value = '30' />
				<sc name = 'outCap30' />
			</set>
		</expectedmessages>

		<endcap name = 'ec10' expression = 'outCap10' />
		<endcap name = 'ec20' expression = 'outCap20' />
		<endcap name = 'ec30' expression = 'outCap30' />

		<expectedmessages>
			<set ecname = 'ec10' >
				<number value = '1' />
			</set>
			<set ecname = 'ec10' >
				<number value = '3' />
			</set>
			<set ecname = 'ec20' >
				<number value = '1' />
			</set>
			<set ecname = 'ec20' >
				<number value = '2' />
			</set>
			<set ecname = 'ec30' >
				<number value = '2' />
			</set>
			<set ecname = 'ec30' >
				<number value = '3' />
			</set>
		</expectedmessages>

		<messages>
			<remove scname='sc3'>
				<number value = '30' />
			</remove>
		</messages>

		<expectedmessages>
			<remove ecname ='ec30'>
				<number value = '3' />
			</remove>
		</expectedmessages>

		<messages>
			<remove scname='sc'>
				<number value = '2' />
			</remove>
		</messages>

		<expectedmessages>
			<remove ecname ='ec20'>
				<number value = '2' />
			</remove>
			<remove ecname ='ec30'>
				<number value = '2' />
			</remove>
			<remove ecname = 'ec' >
				<number value = '30' />
			</remove>
		</expectedmessages>

	</test>

	<test name='returnUnitTest1'>

		<endcap name = 'ec' expression = 'returnUnit 1' />

		<expectedmessages>
			<set ecname = 'ec' >
				<number value = '1' />
			</set>
		</expectedmessages>
	
	</test>

	<test name='returnUnitSetTest1'>
		<startcap name='sc' type='unit number' />

		<endcap name = 'ec' expression = 'returnUnitSet sc' />

		<messages>
			<set scname = 'sc'>
				<number value='2' />
			</set>
		</messages>
		
		<expectedmessages>
			<set ecname = 'ec' >
				<number value = '2' />
			</set>
		</expectedmessages>
		
		<messages>
			<remove scname = 'sc'>
				<number value='2' />
			</remove>
			<set scname = 'sc' >
				<number value = '4' />
			</set>
		</messages>
		
		<expectedmessages>
			<remove ecname = 'ec'>
				<number value='2' />
			</remove>
			<set ecname = 'ec' >
				<number value = '4' />
			</set>
		</expectedmessages>
	</test>

	<test name='reactiveApplyTest1'>
		<startcap name='sc' type='unit (Number -> Set Number)' />

		<endcap name = 'ec' expression = 'reactiveApply sc 5' />

		<messages>
			<set scname = 'sc'>
				<func name='oneTo' />
			</set>
		</messages>

		<expectedmessages>
			<set ecname = 'ec' >
				<sc name = 'resultCap' />
			</set>
		</expectedmessages>
		
		<endcap name = 'ec2' expression = 'resultCap' />
		
		<expectedmessages>
			<set ecname = 'ec2' >
				<number value = '1' />
			</set>
			<set ecname = 'ec2' >
				<number value = '2' />
			</set>
			<set ecname = 'ec2' >
				<number value = '3' />
			</set>
			<set ecname = 'ec2' >
				<number value = '4' />
			</set>
			<set ecname = 'ec2' >
				<number value = '5' />
			</set>
		</expectedmessages>

		<messages>
			<remove scname ='sc'>
				<func name='oneTo' />
			</remove>
			<set scname ='sc'>
				<func name='x2' />
			</set>
		</messages>

		<expectedmessages>
			<remove ecname = 'ec' >
				<sc name = 'resultCap' />
			</remove>
			<set ecname = 'ec' >
				<sc name = 'resultCap2' />
			</set>
		</expectedmessages>

		<endcap name = 'ec3' expression = 'resultCap2' />
		
		<expectedmessages>
			<set ecname = 'ec3' >
				<number value = '10' />
			</set>
		</expectedmessages>

	</test>

	<test name='anyTest1'>
		<startcap name='sc' type='Set Bool' />

		<endcap name = 'ec' expression = 'any (compose returnUnit (equal false)) sc' />

		<messages>
			<set scname = 'sc'>
				<bool value='true'/>
			</set>
		</messages>

		<expectedmessages>
			<set ecname = 'ec' >
				<bool value='false'/>
			</set>
		</expectedmessages>

		<messages>
			<set scname = 'sc'>
				<bool value='false'/>
			</set>
		</messages>

		<expectedmessages>
			<remove ecname = 'ec' >
				<bool value='false'/>
			</remove>
			<set ecname = 'ec' >
				<bool value='true'/>
			</set>
		</expectedmessages>

	</test>
	
	<test name='passThruTest1'>

		<endcap name = 'ec' expression = 'passThru not false' />

		<expectedmessages>
			<set ecname = 'ec' >
				<bool value='false'/>
			</set>
		</expectedmessages>

		<endcap name = 'ec2' expression = 'passThru not true' />

		<expectedmessages>
			<none ecname = 'ec' />
		</expectedmessages>

	</test>

	<test name='buildMapTest1'>

		<startcap name = 'sc' type = 'set number' />

		<endcap name = 'ec' expression = 'buildMap (add 2) sc' />

		<messages>
			<set scname = 'sc'>
				<number value = '1' />
			</set>
			<set scname = 'sc'>
				<number value = '2' />
			</set>
		</messages>

		<expectedmessages>
			<set ecname = 'ec'>
				<number value = '1' />
				<number value = '3' />
			</set>
			<set ecname = 'ec'>
				<number value = '2' />
				<number value = '4' />
			</set>
		</expectedmessages>

	</test>

</tests>